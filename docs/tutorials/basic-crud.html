<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic CRUD Operations - SIMPLE_SQL Tutorial</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>SIMPLE_SQL</h1>
                <span class="version">v1.0 - 460+ Tests</span>
            </div>

            <div class="nav-section">
                <h3>Getting Started</h3>
                <ul>
                    <li><a href="../index.html">Overview</a></li>
                    <li><a href="../getting-started.html">Quick Start</a></li>
                    <li><a href="../installation.html">Installation</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Tutorials</h3>
                <ul>
                    <li><a href="basic-crud.html" class="active">Basic CRUD</a></li>
                    <li><a href="query-builder.html">Query Builder</a></li>
                    <li><a href="transactions.html">Transactions</a></li>
                    <li><a href="soft-deletes.html">Soft Deletes</a></li>
                    <li><a href="eager-loading.html">Eager Loading</a></li>
                    <li><a href="pagination.html">Pagination</a></li>
                    <li><a href="full-text-search.html">Full-Text Search</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Mock Applications</h3>
                <ul>
                    <li><a href="../mock-apps/todo.html">TODO App</a></li>
                    <li><a href="../mock-apps/cpm.html">CPM Scheduler</a></li>
                    <li><a href="../mock-apps/habit-tracker.html">Habit Tracker</a></li>
                    <li><a href="../mock-apps/dms.html">Document Management</a></li>
                </ul>
            </div>
        </nav>

        <main class="main-content">
            <div class="breadcrumbs">
                <a href="../index.html">Home</a> <span>&rsaquo;</span> <a href="../index.html#tutorials">Tutorials</a> <span>&rsaquo;</span> Basic CRUD
            </div>

            <h1>Basic CRUD Operations</h1>
            <p>Learn the fundamentals of Create, Read, Update, and Delete operations with SIMPLE_SQL.</p>

            <h2>Setting Up</h2>
            <pre><code class="eiffel"><span class="keyword">local</span>
    db: <span class="class-name">SIMPLE_SQL_DATABASE</span>
<span class="keyword">do</span>
    <span class="comment">-- Create file-based database</span>
    <span class="keyword">create</span> db.make (<span class="string">"myapp.db"</span>)

    <span class="comment">-- Or use in-memory database for testing</span>
    <span class="keyword">create</span> db.make_memory
<span class="keyword">end</span></code></pre>

            <h2>Create (INSERT)</h2>
            <p>Insert data using the fluent builder or raw SQL.</p>

            <h3>Using the Fluent Builder</h3>
            <pre><code class="eiffel"><span class="comment">-- Create table first</span>
db.execute (<span class="string">"CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT NOT NULL, email TEXT UNIQUE, active INTEGER DEFAULT 1)"</span>)

<span class="comment">-- Insert a row</span>
db.insert_into (<span class="string">"users"</span>)
    .value (<span class="string">"name"</span>, <span class="string">"Alice"</span>)
    .value (<span class="string">"email"</span>, <span class="string">"alice@example.com"</span>)
    .execute

<span class="comment">-- Get the auto-generated ID</span>
print (<span class="string">"Inserted user ID: "</span> + db.last_insert_rowid.out)</code></pre>

            <h3>Using Raw SQL with Parameters</h3>
            <pre><code class="eiffel">db.execute_with_args (<span class="string">"INSERT INTO users (name, email) VALUES (?, ?)"</span>, &lt;&lt;<span class="string">"Bob"</span>, <span class="string">"bob@example.com"</span>&gt;&gt;)</code></pre>

            <h2>Read (SELECT)</h2>
            <p>Query data and iterate through results.</p>

            <h3>Select All Rows</h3>
            <pre><code class="eiffel"><span class="keyword">local</span>
    result: <span class="class-name">SIMPLE_SQL_RESULT</span>
<span class="keyword">do</span>
    result := db.select_from (<span class="string">"users"</span>).execute

    <span class="keyword">across</span> result <span class="keyword">as</span> row <span class="keyword">loop</span>
        print (row.integer_value (<span class="string">"id"</span>).out + <span class="string">": "</span>)
        print (row.string_value (<span class="string">"name"</span>) + <span class="string">"%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>

            <h3>Select with Conditions</h3>
            <pre><code class="eiffel">result := db.select_from (<span class="string">"users"</span>)
    .columns (<span class="string">"id, name, email"</span>)
    .where (<span class="string">"active = ?"</span>, 1)
    .order_by (<span class="string">"name ASC"</span>)
    .limit (10)
    .execute</code></pre>

            <h3>Select Single Row</h3>
            <pre><code class="eiffel">result := db.select_from (<span class="string">"users"</span>)
    .where (<span class="string">"id = ?"</span>, user_id)
    .execute

<span class="keyword">if</span> <span class="keyword">attached</span> result.first <span class="keyword">as</span> user <span class="keyword">then</span>
    print (<span class="string">"Found: "</span> + user.string_value (<span class="string">"name"</span>))
<span class="keyword">else</span>
    print (<span class="string">"User not found"</span>)
<span class="keyword">end</span></code></pre>

            <h2>Update</h2>
            <p>Modify existing rows.</p>

            <h3>Update Single Row</h3>
            <pre><code class="eiffel">db.update (<span class="string">"users"</span>)
    .set (<span class="string">"name"</span>, <span class="string">"Alice Smith"</span>)
    .set (<span class="string">"email"</span>, <span class="string">"alice.smith@example.com"</span>)
    .where (<span class="string">"id = ?"</span>, 1)
    .execute

print (<span class="string">"Updated "</span> + db.changes.out + <span class="string">" row(s)"</span>)</code></pre>

            <h3>Batch Update</h3>
            <pre><code class="eiffel"><span class="comment">-- Deactivate all users who haven't logged in</span>
db.update (<span class="string">"users"</span>)
    .set (<span class="string">"active"</span>, 0)
    .where (<span class="string">"last_login < datetime('now', '-90 days')"</span>)
    .execute</code></pre>

            <h2>Delete</h2>
            <p>Remove rows from the database.</p>

            <h3>Delete Single Row</h3>
            <pre><code class="eiffel">db.delete_from (<span class="string">"users"</span>)
    .where (<span class="string">"id = ?"</span>, user_id)
    .execute

print (<span class="string">"Deleted "</span> + db.changes.out + <span class="string">" row(s)"</span>)</code></pre>

            <div class="callout warning">
                <div class="callout-title">Always Use WHERE</div>
                <p>Without a WHERE clause, DELETE removes ALL rows. Consider using <a href="soft-deletes.html">soft deletes</a> for recoverable data.</p>
            </div>

            <h2>Complete Example</h2>
            <pre><code class="eiffel"><span class="keyword">class</span> <span class="class-name">CRUD_EXAMPLE</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span> {<span class="class-name">NONE</span>}

    make
        <span class="keyword">local</span>
            db: <span class="class-name">SIMPLE_SQL_DATABASE</span>
            result: <span class="class-name">SIMPLE_SQL_RESULT</span>
        <span class="keyword">do</span>
            <span class="keyword">create</span> db.make_memory

            <span class="comment">-- Create</span>
            db.execute (<span class="string">"CREATE TABLE products (id INTEGER PRIMARY KEY, name TEXT, price REAL)"</span>)
            db.insert_into (<span class="string">"products"</span>).value (<span class="string">"name"</span>, <span class="string">"Widget"</span>).value (<span class="string">"price"</span>, 9.99).execute
            db.insert_into (<span class="string">"products"</span>).value (<span class="string">"name"</span>, <span class="string">"Gadget"</span>).value (<span class="string">"price"</span>, 19.99).execute

            <span class="comment">-- Read</span>
            result := db.select_from (<span class="string">"products"</span>).execute
            <span class="keyword">across</span> result <span class="keyword">as</span> p <span class="keyword">loop</span>
                print (p.string_value (<span class="string">"name"</span>) + <span class="string">": $"</span> + p.real_value (<span class="string">"price"</span>).out + <span class="string">"%N"</span>)
            <span class="keyword">end</span>

            <span class="comment">-- Update</span>
            db.update (<span class="string">"products"</span>).set (<span class="string">"price"</span>, 14.99).where (<span class="string">"name = ?"</span>, <span class="string">"Widget"</span>).execute

            <span class="comment">-- Delete</span>
            db.delete_from (<span class="string">"products"</span>).where (<span class="string">"price > 15"</span>).execute

            db.close
        <span class="keyword">end</span>

<span class="keyword">end</span></code></pre>

            <h2>Next Steps</h2>
            <ul>
                <li><a href="query-builder.html">Query Builder</a> - Advanced query construction</li>
                <li><a href="transactions.html">Transactions</a> - Atomic operations</li>
                <li><a href="../api/database.html">API Reference</a> - Full SIMPLE_SQL_DATABASE documentation</li>
            </ul>

            <div class="doc-footer">
                <p><a href="../getting-started.html">&larr; Getting Started</a> | <a href="query-builder.html">Query Builder &rarr;</a></p>
            </div>
        </main>
    </div>
</body>
</html>
