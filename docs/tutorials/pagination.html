<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagination - SIMPLE_SQL Tutorial</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>SIMPLE_SQL</h1>
                <span class="version">v1.0 - 460+ Tests</span>
            </div>

            <div class="nav-section">
                <h3>Getting Started</h3>
                <ul>
                    <li><a href="../index.html">Overview</a></li>
                    <li><a href="../getting-started.html">Quick Start</a></li>
                    <li><a href="../installation.html">Installation</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Tutorials</h3>
                <ul>
                    <li><a href="basic-crud.html">Basic CRUD</a></li>
                    <li><a href="query-builder.html">Query Builder</a></li>
                    <li><a href="transactions.html">Transactions</a></li>
                    <li><a href="soft-deletes.html">Soft Deletes</a></li>
                    <li><a href="eager-loading.html">Eager Loading</a></li>
                    <li><a href="pagination.html" class="active">Pagination</a></li>
                    <li><a href="full-text-search.html">Full-Text Search</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Mock Applications</h3>
                <ul>
                    <li><a href="../mock-apps/todo.html">TODO App</a></li>
                    <li><a href="../mock-apps/cpm.html">CPM Scheduler</a></li>
                    <li><a href="../mock-apps/habit-tracker.html">Habit Tracker</a></li>
                    <li><a href="../mock-apps/dms.html">Document Management</a></li>
                </ul>
            </div>
        </nav>

        <main class="main-content">
            <div class="breadcrumbs">
                <a href="../index.html">Home</a> <span>&rsaquo;</span> <a href="../index.html#tutorials">Tutorials</a> <span>&rsaquo;</span> Pagination
            </div>

            <h1>Pagination</h1>
            <p>Efficiently paginate large result sets using cursor-based pagination.</p>

            <h2>Offset vs Cursor Pagination</h2>

            <h3>Offset Pagination (Simple but Slow)</h3>
            <pre><code class="eiffel"><span class="comment">-- Page 1</span>
result := db.select_from (<span class="string">"posts"</span>).limit (20).offset (0).execute

<span class="comment">-- Page 2</span>
result := db.select_from (<span class="string">"posts"</span>).limit (20).offset (20).execute

<span class="comment">-- Page 100 (SLOW - must scan 2000 rows)</span>
result := db.select_from (<span class="string">"posts"</span>).limit (20).offset (1980).execute</code></pre>

            <div class="callout warning">
                <div class="callout-title">Offset Performance</div>
                <p>OFFSET becomes slower as values increase because SQLite must scan and discard all skipped rows.</p>
            </div>

            <h3>Cursor Pagination (Efficient)</h3>
            <p>Use SIMPLE_SQL_PAGINATOR for efficient cursor-based pagination.</p>
            <pre><code class="eiffel"><span class="keyword">local</span>
    paginator: <span class="class-name">SIMPLE_SQL_PAGINATOR</span>
    page: <span class="class-name">SIMPLE_SQL_PAGE</span>
<span class="keyword">do</span>
    paginator := db.paginator (<span class="string">"posts"</span>)
        .columns (<span class="string">"id, title, created_at"</span>)
        .order_by (<span class="string">"id"</span>)
        .page_size (20)

    <span class="comment">-- Get first page</span>
    page := paginator.first_page

    <span class="keyword">across</span> page.items <span class="keyword">as</span> row <span class="keyword">loop</span>
        print (row.string_value (<span class="string">"title"</span>) + <span class="string">"%N"</span>)
    <span class="keyword">end</span>

    <span class="comment">-- Get next page using cursor</span>
    <span class="keyword">if</span> page.has_more <span class="keyword">then</span>
        page := paginator.after (page.cursor)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>

            <h2>SIMPLE_SQL_PAGINATOR API</h2>

            <h3>Configuration</h3>
            <pre><code class="eiffel">paginator := db.paginator (<span class="string">"documents"</span>)
    .columns (<span class="string">"id, title, author_id, created_at"</span>)
    .where (<span class="string">"published = 1"</span>)
    .order_by (<span class="string">"created_at DESC, id DESC"</span>)  <span class="comment">-- Composite key for stable ordering</span>
    .page_size (25)</code></pre>

            <h3>Navigation</h3>
            <pre><code class="eiffel"><span class="comment">-- First page</span>
page := paginator.first_page

<span class="comment">-- Next page (after current cursor)</span>
<span class="keyword">if</span> page.has_more <span class="keyword">then</span>
    next_page := paginator.after (page.cursor)
<span class="keyword">end</span>

<span class="comment">-- Previous page (before current cursor)</span>
prev_page := paginator.before (page.cursor)</code></pre>

            <h2>SIMPLE_SQL_PAGE</h2>
            <pre><code class="eiffel"><span class="comment">-- Access page data</span>
page.items       <span class="comment">-- ARRAYED_LIST [SIMPLE_SQL_ROW]</span>
page.cursor      <span class="comment">-- STRING for next page</span>
page.has_more    <span class="comment">-- BOOLEAN - more pages available?</span>
page.count       <span class="comment">-- INTEGER - items on this page</span></code></pre>

            <h2>Complete Example: Paginated List</h2>
            <pre><code class="eiffel"><span class="keyword">class</span> <span class="class-name">DOCUMENT_LIST</span>

<span class="keyword">feature</span>

    paginator: <span class="class-name">SIMPLE_SQL_PAGINATOR</span>
    current_cursor: detachable <span class="class-name">STRING</span>

    initialize (a_db: <span class="class-name">SIMPLE_SQL_DATABASE</span>)
        <span class="keyword">do</span>
            paginator := a_db.paginator (<span class="string">"documents"</span>)
                .columns (<span class="string">"id, title, updated_at"</span>)
                .where (<span class="string">"deleted_at IS NULL"</span>)
                .order_by (<span class="string">"updated_at DESC, id DESC"</span>)
                .page_size (20)
        <span class="keyword">end</span>

    load_first_page: <span class="class-name">SIMPLE_SQL_PAGE</span>
        <span class="keyword">do</span>
            Result := paginator.first_page
            current_cursor := Result.cursor
        <span class="keyword">end</span>

    load_next_page: <span class="class-name">SIMPLE_SQL_PAGE</span>
        <span class="keyword">require</span>
            has_cursor: <span class="keyword">attached</span> current_cursor
        <span class="keyword">do</span>
            Result := paginator.after (current_cursor)
            current_cursor := Result.cursor
        <span class="keyword">end</span>

    display_page (a_page: <span class="class-name">SIMPLE_SQL_PAGE</span>)
        <span class="keyword">do</span>
            <span class="keyword">across</span> a_page.items <span class="keyword">as</span> doc <span class="keyword">loop</span>
                print (doc.integer_value (<span class="string">"id"</span>).out + <span class="string">". "</span>)
                print (doc.string_value (<span class="string">"title"</span>) + <span class="string">"%N"</span>)
            <span class="keyword">end</span>

            <span class="keyword">if</span> a_page.has_more <span class="keyword">then</span>
                print (<span class="string">"[More available]%N"</span>)
            <span class="keyword">else</span>
                print (<span class="string">"[End of list]%N"</span>)
            <span class="keyword">end</span>
        <span class="keyword">end</span>

<span class="keyword">end</span></code></pre>

            <h2>API Pagination Pattern</h2>
            <p>For REST APIs, include the cursor in the response:</p>
            <pre><code class="eiffel"><span class="comment">-- Client requests: GET /documents?cursor=abc123</span>
<span class="comment">-- Server responds with:</span>
<span class="comment">{</span>
<span class="comment">  "items": [...],</span>
<span class="comment">  "next_cursor": "def456",</span>
<span class="comment">  "has_more": true</span>
<span class="comment">}</span></code></pre>

            <div class="callout tip">
                <div class="callout-title">Stable Ordering</div>
                <p>Always include a unique column (like <code>id</code>) in your ORDER BY to ensure stable pagination when values in other columns are equal.</p>
            </div>

            <h2>When to Use Each Approach</h2>
            <table>
                <thead>
                    <tr>
                        <th>Approach</th>
                        <th>Best For</th>
                        <th>Avoid When</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Offset</td>
                        <td>Small datasets (&lt;1000 rows), need to jump to specific page</td>
                        <td>Large datasets, high page numbers</td>
                    </tr>
                    <tr>
                        <td>Cursor</td>
                        <td>Large datasets, infinite scroll, real-time feeds</td>
                        <td>Need to jump to arbitrary page number</td>
                    </tr>
                </tbody>
            </table>

            <h2>Next Steps</h2>
            <ul>
                <li><a href="full-text-search.html">Full-Text Search</a> - Search within paginated results</li>
                <li><a href="../api/paginator.html">API Reference</a> - Full paginator documentation</li>
            </ul>

            <div class="doc-footer">
                <p><a href="eager-loading.html">&larr; Eager Loading</a> | <a href="full-text-search.html">Full-Text Search &rarr;</a></p>
            </div>
        </main>
    </div>
</body>
</html>
